# --- 1. Identity & Discovery (For 'init') ---
query GetMe {
  me {
    id
    username
    publications(first: 5) {
      edges {
        node {
          id
          title
          url
        }
      }
    }
  }
}

# --- 2. Content State & Import Engine ---
# This query handles both 'plan' (checking diffs) and 'import' (downloading everything)
query GetPublicationData($id: ObjectId!, $first: Int!, $after: String) {
  publication(id: $id) {
    title
    posts(first: $first, after: $after) {
      edges {
        node {
          id
          title
          slug
          brief
          publishedAt
          # Content is needed to calculate local checksums and for file creation during import
          content {
            markdown
          }
          # Metadata for Frontmatter reconstruction
          tags {
            name
            slug
          }
          series {
            id
            name
            slug
          }
          coverImage {
            url
          }
        }
      }
      # Crucial for the import loop to know if there's more data
      pageInfo {
        hasNextPage
        endCursor
      }
    }
    # Fetch Series list to allow mapping names to IDs and recreating series folders
    seriesList(first: 50) {
      edges {
        node {
          id
          name
          slug
          description
        }
      }
    }
  }
}

# --- 3. Mutations (For 'apply') ---

# Publish new post (includes seriesId for auto-assignment)
mutation PublishPost($input: PublishPostInput!) {
  publishPost(input: $input) {
    post {
      id
      slug
      url
    }
  }
}

# Update existing post
mutation UpdatePost($input: UpdatePostInput!) {
  updatePost(input: $input) {
    post {
      id
      slug
      updatedAt
    }
  }
}

# Create a new series if it doesn't exist locally
mutation CreateSeries($input: CreateSeriesInput!) {
  createSeries(input: $input) {
    series {
      id
      name
      slug
    }
  }
} 